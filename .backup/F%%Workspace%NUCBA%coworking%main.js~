const form = document.getElementById("form");
const cardsContainer = document.getElementById("cards-container");

let agenda = JSON.parse(localStorage.getItem("agenda")) || [];

const submitForm = (e) => {
	e.preventDefault();

	// if (isValidForm()) {
	saveData();
	alert("El turno se ha creado correctamente");
	saveToLocalStorage();

	form.reset();
	renderAgenda();

	setDateIntervals();
	// }
};

const objetoRaro = {};
objetoRaro.menos5 = "Menos de 5 personas";
objetoRaro["510"] = "Entre 5 y 10 personas";
objetoRaro.mas10 = "Mas de 10 personas";

renderTurn = (turno) => {
	const { id, name, lastName, phone, email, date, time, quantity, extras } =
		turno;

	return `<div class="card ${setCardBackground(quantity)}">
          <div class="card_left">
            <h2 class="card__tittle">Orden: N-${id} - ${name} ${lastName}</h2>
            <p class="card__qty">${objetoRaro[quantity]}</p>
            <p class="card__extras">
							${extras.join(", ")}
            </p>
            <div class="tags">
              <span class="card__hour ${setTimeBackground(quantity)}">
							${time}
							</span>
              <span class="card__date ${setDateBackground(quantity)}">
							${date}
							</span>
            </div>
          </div>
          <div class="card__right">
						<a href="https://mail.google.com/mail/?view=cm&fs=1&tf=1&to=${email}">
						<i class="fa-solid fa-envelope"></i>
						</a>
						<a href="https://api.whatsapp.com/send?phone=+549${phone}&text=SAAAAPPPPEEEEEEE">
						<i class="fa-solid fa-phone-flip"></i>
						</a>
            <img
						src=${setCardImg(quantity)}
						class="card__img ${setCardImgClass(quantity)}"
						alt=""
						/>
          </div>
        </div>`;
};

const renderAgenda = () => {
	cardsContainer.innerHTML = agenda.map((turn) => renderTurn(turn)).join("");
};

const saveData = () => {
	agenda = [
		...agenda,
		{
			id: agenda.length + 1,
			name: nameInput.value,
			lastName: lastNameInput.value,
			phone: phoneInput.value,
			email: emailInput.value,
			date: formatDate(dateInput.value),
			time: hourInput.value,
			quantity: getRadioValue(radioInputs),
			extras: getCheckedOptions(checkboxInputs),
			about: aboutInput.value,
		},
	];
};

const saveToLocalStorage = () => {
	localStorage.setItem("agenda", JSON.stringify(agenda));
};

const init = () => {
	window.addEventListener("DOMContentLoaded", setDateIntervals);

	form.addEventListener("submit", submitForm);
};

init();
